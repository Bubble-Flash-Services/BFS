# Setup and Run in Android Studio

Complete guide to set up and run the BFS mobile app in Android Studio.

## Understanding the Project Files

### Why .java Files?
The `.java` files in `android/app/src/main/java/` are **automatically generated by Capacitor** and are required:

- **MainActivity.java** - Entry point for the Android app (5 lines of code)
- Extends `BridgeActivity` which bridges your React web code to native Android
- **DO NOT DELETE** - These are essential for the app to run

### What are splash.png Images?
The `splash.png` files in `android/app/src/main/res/drawable-*/` are:

- **Splash screens with BFS logo** (loading screen when app starts)
- Generated from `public/logo.jpg` in multiple sizes for different screen densities
- Multiple sizes for different screen densities (hdpi, xhdpi, xxhdpi, xxxhdpi)
- Different orientations (portrait and landscape)
- **Custom branded** with your BFS logo centered on white background

---

## Prerequisites

Before starting, ensure you have:

1. **Node.js** (v14 or higher) - `node --version`
2. **npm** - `npm --version`
3. **Android Studio** (latest stable version) - [Download here](https://developer.android.com/studio)
4. **Java JDK** (v11 or higher) - `java --version`

---

## Step 1: Install Dependencies

```bash
cd /path/to/BFS
npm install
```

This installs all required packages including:
- Capacitor core, CLI, and Android platform
- React and Vite build tools
- All other project dependencies

---

## Step 2: Build the React App

```bash
npm run build
```

This creates the production build in the `dist/` folder that will be packaged into the Android app.

**Output**: You should see `✓ built in ~15s` with files in `dist/` folder.

---

## Step 3: Sync to Android

```bash
npm run sync:android
```

Or use the all-in-one command:
```bash
npm run build:android
```
(This builds React app, syncs to Android, and opens Android Studio)

**What this does**:
- Copies web assets from `dist/` to `android/app/src/main/assets/public/`
- Copies `capacitor.config.json` to Android project
- Updates Android plugins
- Prepares the project for Android Studio

---

## Step 4: Open in Android Studio

### Option A: Using Command
```bash
npm run open:android
```

### Option B: Manual
1. Open Android Studio
2. Click **File > Open**
3. Navigate to your project's `android/` folder
4. Click **OK**

---

## Step 5: Configure Android Studio (First Time Only)

When Android Studio opens the project:

### 1. Wait for Gradle Sync
- Android Studio will automatically sync Gradle (bottom right progress bar)
- This may take 2-5 minutes on first run
- Wait until you see "Gradle sync finished"

### 2. Accept Android SDK Licenses
If prompted:
```bash
# In terminal
cd android
./gradlew --version
```

### 3. Set Up Android SDK
If needed:
- Go to **File > Settings > Appearance & Behavior > System Settings > Android SDK**
- Ensure SDK 34 (Android 14) is installed
- Click **Apply** if installing

---

## Step 6: Set Up a Device

### Option A: Physical Device (Recommended)

1. **Enable Developer Options** on your Android phone:
   - Go to **Settings > About Phone**
   - Tap **Build Number** 7 times
   - You'll see "You are now a developer!"

2. **Enable USB Debugging**:
   - Go to **Settings > Developer Options**
   - Enable **USB Debugging**

3. **Connect via USB**:
   - Plug in your phone
   - Allow USB debugging when prompted
   - Your device should appear in Android Studio's device dropdown

### Option B: Emulator

1. Click **Device Manager** icon (phone icon in toolbar)
2. Click **Create Device**
3. Choose a device (e.g., Pixel 6)
4. Download system image (API 34 recommended)
5. Click **Finish**
6. Start the emulator

---

## Step 7: Run the App

1. **Select Device**: In the toolbar, select your device/emulator from dropdown
2. **Click Run**: Click the green play button (▶️) or press `Shift + F10`
3. **Wait for Build**: First build may take 3-5 minutes
4. **App Launches**: The BFS app will install and open automatically

### Expected Output
```
BUILD SUCCESSFUL in 2m 15s
Installing APK...
Launching app...
```

The app should open on your device showing the BFS homepage.

---

## Common Commands

```bash
# Build React app
npm run build

# Sync changes to Android
npm run sync:android

# Build React + Sync + Open Android Studio
npm run build:android

# Open Android Studio
npm run open:android
```

---

## Development Workflow

When making changes to your React code:

1. **Edit React code** in `src/` folder
2. **Build**: `npm run build`
3. **Sync**: `npm run sync:android`
4. **Run** in Android Studio (click ▶️)

**Quick Iteration**:
- For web development, use `npm run dev` (faster)
- Test in browser first, then sync to Android when ready

---

## Troubleshooting

### Issue: "Gradle sync failed"
**Solution**:
```bash
cd android
./gradlew clean
cd ..
npm run sync:android
```

### Issue: "White screen on launch"
**Solution**:
```bash
# Ensure build was successful
npm run build
# Check dist folder exists
ls -la dist/
# Re-sync
npm run sync:android
```

### Issue: "Device not detected"
**Solution**:
- Check USB cable is connected
- Enable USB debugging on phone
- Try different USB port
- Run `adb devices` to verify connection

### Issue: "SDK not found"
**Solution**:
- Open Android Studio > Settings > Android SDK
- Install Android SDK 34
- Set `ANDROID_HOME` environment variable:
  ```bash
  export ANDROID_HOME=$HOME/Android/Sdk
  export PATH=$PATH:$ANDROID_HOME/platform-tools
  ```

### Issue: "Build too slow"
**Solution**:
- Close other applications
- Increase Android Studio memory:
  - Help > Edit Custom VM Options
  - Set `-Xmx4096m` (4GB RAM)
- Enable parallel builds in `gradle.properties`:
  ```
  org.gradle.parallel=true
  org.gradle.daemon=true
  ```

### Issue: "Port 8080 already in use"
**Solution**:
- The app uses port from capacitor config
- Kill process: `lsof -ti:8080 | xargs kill`

---

## Debugging

### View Console Logs

1. **Android Studio Logcat**:
   - Click **Logcat** tab at bottom
   - Filter by package name: `com.bubbleflashservices.bfsapp`
   - View `console.log()` output and errors

2. **Chrome DevTools** (Advanced):
   - Open Chrome
   - Go to `chrome://inspect`
   - Click **Inspect** under your device
   - Access full browser developer tools

### Common Logs to Check
- Network requests: Filter by "API" or "fetch"
- Errors: Filter by "Error" or "Exception"
- Capacitor: Filter by "Capacitor"

---

## Hot Tips

1. **Keep Android Studio Updated**: Help > Check for Updates
2. **Use Physical Device**: Faster and more accurate than emulator
3. **Test on Multiple Devices**: Different screen sizes and Android versions
4. **Gradle Daemon**: Speeds up builds (already enabled)
5. **Incremental Builds**: Only changed code is rebuilt

---

## Project Structure

```
BFS/
├── android/                          # Android project (Capacitor generated)
│   ├── app/
│   │   ├── src/main/
│   │   │   ├── java/                # MainActivity.java (required)
│   │   │   ├── res/                 # splash.png images (required)
│   │   │   └── assets/public/       # Your built web app
│   │   └── build.gradle
│   └── build.gradle
├── src/                              # React source code
├── dist/                             # Built web app (npm run build)
├── capacitor.config.json             # Capacitor configuration
└── package.json                      # Dependencies and scripts
```

---

## Next Steps

Once you can run the app:
1. Test all features (login, orders, services)
2. Check API connectivity
3. Test on different Android versions
4. Fix any UI issues for mobile screens
5. Ready for Play Store deployment (see PLAYSTORE_DEPLOY.md)

---

## Quick Reference Card

| Task | Command |
|------|---------|
| Install dependencies | `npm install` |
| Build React app | `npm run build` |
| Sync to Android | `npm run sync:android` |
| Open Android Studio | `npm run open:android` |
| All-in-one | `npm run build:android` |
| Clean build | `cd android && ./gradlew clean` |

---

**Need help?** Check Android Studio's Logcat for error messages.

**Ready to deploy?** See `PLAYSTORE_DEPLOY.md` for Play Store submission guide.
